<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - KokKokKok</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 50px auto; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        .btn { display: block; width: 100%; padding: 12px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .btn:hover { background: #1976D2; }
        .message { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #e8f5e9; color: #2E7D32; }
        .error { background: #ffebee; color: #d32f2f; }
        .back-link { display: block; text-align: center; margin-top: 20px; color: #666; text-decoration: none; }
        .back-link:hover { color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ลืมรหัสผ่าน?</h1>
        <p>กรุณากรอกอีเมลที่ใช้สมัครสมาชิก เราจะส่งลิงก์รีเซ็ตรหัสผ่านให้คุณ</p>
        
        <div class="form-group">
            <label for="email">อีเมล</label>
            <input type="email" id="email" placeholder="your@email.com">
        </div>
        
        <button onclick="sendResetLink()" class="btn">ส่งลิงก์รีเซ็ตรหัสผ่าน</button>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <a href="/templates/login.html" class="back-link">← กลับไปหน้าล็อกอิน</a>
    </div>
    
    <script>
    async function sendResetLink() {
        const email = document.getElementById('email').value.trim();
        const messageDiv = document.getElementById('message');
        
        if (!email) {
            showMessage('กรุณากรอกอีเมล', 'error');
            return;
        }
        
        // Show loading
        showMessage('กำลังส่งลิงก์รีเซ็ต...', 'info');
        
        try {
            const response = await fetch('/api/auth/forgot-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: email })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showMessage(data.message, 'success');
                
                // In development, show the reset link
                if (data.resetLink) {
                    console.log('Reset link:', data.resetLink);
                    showMessage(`${data.message}<br><br>Development link: <a href="${data.resetLink}">${data.resetLink}</a>`, 'success');
                }
            } else {
                showMessage(data.message || 'เกิดข้อผิดพลาด', 'error');
            }
            
        } catch (error) {
            console.error('Error:', error);
            showMessage('เกิดข้อผิดพลาดในการเชื่อมต่อ', 'error');
        }
    }
    
    function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.innerHTML = text;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = 'block';
    }
    </script>
</body>
</html>